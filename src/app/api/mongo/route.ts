import Table1 from "@/models/Table1";
import Table2 from "@/models/Table2";

import ConnectToMongoDB from "@/utils/MongodbConnect";
import { NextRequest, NextResponse } from "next/server";

//"a√±o","volumen_produccion (ton)","valor_produccion (mil M)"

const csv1 = `2015/01,14.66,0.69,0.13,154987.0,True,1.3650462962962964,318085209.59000003
2015/02,16.2,1.0,0.19,124995.0,True,1.3269444444444445,362637599.23
2015/03,13.87,2.07,0.9,161894.0,False,1.3619814814814817,418583069.77
2015/04,14.49,2.04,0.75,141797.0,False,1.383449074074074,344144395.15
2015/05,15.86,1.85,0.59,130109.0,True,1.344685185185185,483784044.79
2015/06,17.09,1.63,0.59,120759.0,False,1.399074074074074,381826743.71
2015/07,30.37,2.16,0.59,132572.0,True,1.4094444444444445,356701872.63
2015/08,40.7,3.25,0.63,118187.0,True,1.4444814814814817,419244814.82
2015/09,45.21,2.92,0.59,137006.0,True,1.4491435185185184,329218833.05
2015/10,33.05,2.52,0.47,141511.0,True,1.3919675925925927,305776111.02
2015/11,26.35,1.78,0.42,138380.0,True,1.330611111111111,369440036.39
2015/12,18.35,1.4,0.45,130276.0,False,1.3052436194895591,296025931.89
2016/01,16.18,1.41,0.4,143079.0,False,1.2401851851851853,475405765.58
2016/02,31.72,1.71,0.57,135543.0,True,1.2371064814814814,428645801.98
2016/03,33.245000000000005,2.66,0.725,147157.0,True,1.224212962962963,391212408.28
2016/04,41.59,2.565,0.405,132155.0,True,1.2050231481481484,401832751.79
2016/05,41.099999999999994,2.5,0.19,171819.0,False,1.1997222222222224,561230530.57
2016/06,52.61,2.705,0.23,127164.0,True,1.2830555555555554,410328154.08
2016/07,55.065,3.165,0.455,176070.0,False,1.401333333333333,467275344.23
2016/08,37.85,2.395,0.28,173989.0,True,1.4111111111111112,370796966.98
2016/09,20.925,1.755,0.18,282258.0,True,1.4278703703703703,362303275.48
2016/10,25.43,1.75,0.17,230294.0,True,1.5570925925925927,360201804.28
2016/11,26.115,2.42,0.17,200800.0,True,1.550023148148148,260209336.7
2016/12,33.235,2.545,0.18,182666.0,True,1.3159953703703704,331447751.88
2017/01,27.69,1.67,0.325,199379.0,True,1.2775,533333033.41
2017/02,35.175,1.455,0.35,195515.0,True,1.2147916666666665,471467199.84
2017/03,35.995000000000005,1.76,0.335,252425.0,True,1.3989351851851852,358903381.75
2017/04,34.675,1.435,0.36,214286.0,True,1.5026111111111111,489814529.54
2017/05,33.135000000000005,0.6499999999999999,0.125,239791.0,True,1.5325925925925927,425730541.61
2017/06,44.69,0.52,0.0,156550.0,True,1.5453953488372092,410410650.95
2017/07,44.205,1.45,0.0,164609.0,True,1.5649259259259258,474903710.36
2017/08,27.83,0.9199999999999999,0.0,298960.0,True,1.6989583333333331,338332990.18
2017/09,24.439999999999998,0.07500000000000001,0.0,312938.0,True,1.840949074074074,284779536.33
2017/10,17.82,0.12,0.0,222890.0,True,1.7524444444444445,362777956.74
2017/11,25.32,0.735,0.0,201843.0,True,1.5172916666666667,324519308.53
2017/12,29.08,1.68,0.0,251089.0,True,1.363851851851852,459332860.03
2018/01,35.795,3.8499999999999996,0.26,268708.0,True,1.366648148148148,533859955.08
2018/02,44.9,6.0649999999999995,0.53,203156.0,True,1.3187037037037035,497778196.42
2018/03,55.275,10.42,1.555,240014.0,True,1.3364583333333333,455253060.22
2018/04,59.629999999999995,13.754999999999999,4.43,243485.0,True,1.3237962962962964,601617318.89
2018/05,55.135000000000005,14.99,4.675000000000001,210075.0,True,1.2768055555555555,551710917.23
2018/06,45.05,6.7,2.125,160956.0,True,1.3094675925925927,493940184.31
2018/07,51.3,5.904999999999999,1.285,179420.0,True,1.336111111111111,598726135.25
2018/08,59.085,5.975,1.135,238122.0,True,1.4163194444444445,432991665.2
2018/09,37.39,5.135,1.175,182580.0,True,1.4750555555555556,500799569.88
2018/10,26.075,4.055,1.195,187588.0,True,1.3451851851851853,409115679.6
2018/11,20.085,2.3200000000000003,0.35,180357.0,False,1.360138888888889,356400371.95
2018/12,22.31,1.04,0.07,199075.0,True,1.4355555555555557,76350232.77
2019/01,23.165,0.775,0.07,223356.0,True,1.2732638888888888,502972594.18
2019/02,35.54,1.5150000000000001,0.15,182185.0,True,1.1928703703703705,533673596.93
2019/03,45.75,1.75,0.1,234241.0,True,1.218148148148148,634166765.31
2019/04,52.769999999999996,2.925,0.35,393297.0,True,1.4247453703703703,464771747.43
2019/05,55.22,3.605,0.51,254638.0,True,1.530925925925926,466715360.18
2019/06,54.629999999999995,3.82,0.62,204212.0,True,1.5235185185185185,552628083.63
2019/07,63.4,6.055,1.315,238105.0,True,1.7250925925925926,389713387.81
2019/08,66.545,9.11,2.56,237267.0,True,1.6106944444444449,410698490.67
2019/09,59.35,10.96,3.415,229854.0,True,1.4623518518518517,533589540.78
2019/10,48.28,8.385,2.67,269516.0,False,1.3205787037037038,430257633.38
2019/11,35.31,4.445,0.595,215314.0,False,1.2962962962962965,410200014.05
2019/12,26.03,2.7649999999999997,0.405,250093.0,False,1.2720555555555555,493373307.34
2020/01,23.805,2.255,0.29500000000000004,279301.0,False,1.1975462962962964,509513702.17
2020/02,27.415,3.08,0.33999999999999997,258693.0,False,1.2028935185185186,545006585.59
2020/03,32.315,3.14,0.515,338581.0,False,1.3597037037037036,645386359.3100001
2020/04,39.519999999999996,5.595,0.34,203394.0,False,1.3897453703703704,552380633.3
2020/05,35.77,1.145,0.035,204110.0,False,1.3351543209876542,473106765.92`;

const csv2 = `
1980,434259,5387242
1981,459212,7356235
1982,484137,10927970
1983,425139,15650981
1984,430744,28540407
1985,565309,47737446
1986,627819,114113463
1987,520162,185603893
1988,682861,562091394
1989,470196,566402507
1990,680568,1020945361
1991,778521,1615529567
1992,724365,1351111421
1993,702912,1365996427
1994,799827,1183819754
1995,790030,1101205029
1996,837699,1754682142.32
1997,762336,3255180062.52
1998,876623.36,3421524231.69
1999,878855.79,4746623677.27
2000,907308.52,4215133214.72
2001,940229.43,5030864060.67
2002,901074.52,4039305068.79
2003,905041.15,5373581667.75
2004,987323.34,6085761266.87
2005,1021515.46,7617150417.63
2006,1134249.59,9122963597.3
2007,1142892.42,12019378281.1
2008,1162428.92,12459370622.86
2009,1230972.61,15073316456.47
2010,1107135.16,14165758093.97
2011,1264141.46,18136404248.99
2012,1316104.02,16608146755.35
2013,1467837.35,18060177053.45
2014,1520694.5,20715986372.96
2015,1644225.86,22548785129.27
2016,1889353.5,30265787395.11
2017,2029885.85,39705966215.02
2018,2184663.07,41908121255.86
2019,2300888.9,49481376541.25
2020,2393848.57,49369370984.05
2021,2442944.64,50538293377.03
2022,2540715.37,63447915025.7
`;

export async function GET(request: NextRequest) {
  try {
    await ConnectToMongoDB();

    let lines = csv1.trim().split("\n");

    for (const line of lines) {
      const data = line.split(",");

      Table1.create({
        date: data[0],
        sequia_leve: parseFloat(data[1]),
        sequia_moderada: parseFloat(data[2]),
        sequia_grave: parseFloat(data[3]),
        exportaciones_miles_dolares: parseFloat(data[4]),
        evento_violencia: data[5],
        precio_promedio: parseFloat(data[6]),
        total_vendido_US: parseFloat(data[7]),
      });
    }

    lines = csv2.trim().split("\n");

    for (const line of lines) {
      const data = line.split(",");
      Table2.create({
        date: data[0],
        volumen_produccion: parseFloat(data[1]),
        valor_produccion: parseFloat(data[2]),
      });
    }

    return NextResponse.json({ answer: "S" }, { status: 200 });
  } catch (err) {
    console.log(err);
  }
}

// const mainTableSchema = new Schema({
//   date: String,
//   sequia_leve: [Number],
//   sequia_moderada: [Number],
//   sequia_grave: [Number],
//   exportaciones_miles_dolares: [Number],
//   evento_violencia: [String],
//   precio_promedio: [Number],
//   total_vendido_US: [Number],
// });
